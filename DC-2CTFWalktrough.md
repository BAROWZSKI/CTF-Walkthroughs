# DC:1 CTF Walkthrough (Vulnhub) 

###### <p align="center"> *This is official repository maintained by me*</center> </p>
###### <p align="center"> *[yigitdrbk](https://www.instagram.com/yigitdrbk/) *</center> </p>

Dc:2 is a CTF created by DCAU. You can find the technical information about this CTF on the Vulnhub page. First of all, make sure to download and install the correct OVA file from Vulnhub (https://download.vulnhub.com/dc/DC-2.zip).

As mentioned in the description on the Vulnhub page, it is similar to beginner CTFs, but it requires knowledge of Linux and penetration testing tools.

## 1-General Recon
 
After setting your machine’s IP to work on your network, you’re ready to scan. If you can’t reach your machine from another virtual machine or your own computer, you should check your VirtualBox network settings. If you’re trying to reach your machine from another VirtualBox instance, both machines’ network settings should be set to Bridged Adapter or NAT Network. Once that’s configured, you’re ready to start scanning.

To find an IP address on the same network, we can use Nmap or Netdiscover to scan.

```bash
netdiscover -r 10.0.2.0/24 or nmap -sn 10.0.2.0/24
```

![DC2](https://miro.medium.com/v2/resize:fit:828/format:webp/1*5-E1D00A45NfNXisV9C3CA.png "DC2")

The IP address is 10.0.2.11 on my machine. Now I can scan ports, search for directories, view the source page, etc. I started with Nmap, but you can also use Rustscan to quickly find open ports.

```bash
nmap -p- -vv <Machine-Ip> -oN openports
```

After finding the open ports, I performed a script scan and a version scan. Additionally, scanning for vulnerabilities is important at this stage.

```bash
nmap -PN -sS -sV --script vuln -p 80,7744 <Machine-Ip> -oN finalscan
```

So, there are two open ports. One is port 80, which is the classic HTTP port, and the second is the SSH port, which runs on port 7744 instead of the usual port 22.

![DC2](https://miro.medium.com/v2/resize:fit:1100/format:webp/1*PRH_tNzx-brtxCddV54QdA.png "DC2")

In finalscan there is 3 users i found. But for this CTF, I couldn’t access the website by using its IP address directly. This is because the WordPress site is configured to identify itself by its domain name, not by an IP address. Additionally, this could be due to a virtual host configuration, where the web server is set up to serve different websites based on the domain name requested. To resolve this, I had to append the machine’s IP address to the /etc/hosts file like this:

![DC2](https://miro.medium.com/v2/resize:fit:640/format:webp/1*Qe4aeXBQHyVQbOrtrY9AEQ.png "DC2")

After that i was ready to search for directories. I used dirsearch because it’s simple.

```bash
dirseach -u http://dc-2
```
![DC2](https://miro.medium.com/v2/resize:fit:828/format:webp/1*USBSAenwIXpzKrkakSxCLA.png "DC2")

When you visit the website on http://dc-2 , you will see the welcome page. There is a “Flag” directory to the left, and it contains the first flag for this CTF.

The first flag states that usual wordlists won’t work, so I should use Cewl. This means I will perform a brute-force attack on the login page using the usernames “tom,” “jerry,” and “admin,” along with some passwords generated by Cewl.

## 2- Exploiting

I searched for cewl and cewl is a custom word list generator. I simply just used the words on http://dc-2 because some words are suspicious there.

For the pass.txt i used this command after some research :

```bash
cewl http://dc-2 > pass.txt
```
It gave me a 239 line pass.txt (you can search for lines with wc-l pass.txt). I could use Burpsuite , Hydra and similar brute force tools. But there is a tool for wordpress called wpscan. Wpscan is a tool for wordpress website. You can enumerate , make a brute force attack etc. If you can’t find the users for website you could have run the command :

```bash
wpscan --enumerate u --url http://dc-2
```
This command will get you tom,jerry and admin users. But this is not the case.

I made a short wordlist named users.txt (contains tom, jerry and admin) and used the pass.txt from cewl. The brute force with wpscan command :

```bash
wpscan -P pass.txt -U users.txt --url http://dc-2
```
![DC2](https://miro.medium.com/v2/resize:fit:640/format:webp/1*_40p-KB-ZMKOuSCyOfK-HA.png "DC2")

I logged in with jerry credentials on http://dc-2/wp-login.php . In pages page there is second flag. It says if you can’t exploit WordPress and take a shortcut , there is another way. So i tried to ssh.

I tried to ssh with tom credentials.

```bash
ssh -p 7744 tom@10.0.2.11
``` 
p Flag is important here because we aren’t ssh with default port. After the tom password there was 1 file named flag3.txt and 1 directory named usr. I couln’t see what’s inside of flag3.txt so i tried to get , mget and scp. It doesn’t work but i give you the code anyway.

```bash
scp -P 7744 tom@10.0.2.11:/home/tom/flag3.txt ~/Desktop/CTF/Dc-2
```

The above command is used for downloading files on ssh to local computer. But it didn’t work. So i tried to read it with leafpad , nano , cat , more , vim and vi. Vi worked succesfully. The third flag was : “Poor old Tom is always running after Jerry. Perhaps he should su for all the stress he causes.”

## 3- Escaping from restricted shell

I am familiar with vi, which is a basic form of vim. You can execute commands with vi, and in this case, we have a restricted shell. Since I can’t run any commands other than vi, I needed to escape this shell using vim. I tried to cd into the usr directory, but it didn’t work, so I ran the command ls usr, which returned bin. I then ran the command ls usr/bin, which listed the commands I could run: less, ls, scp, and vi.

Less is a command similar to more; it helps with reading large files. I used it to read /etc/passwd, but that didn’t provide any useful information. So, I decided to escape the restricted shell using vi.

I searched and tried many methods, but in the end, I found a simple way. With the vi text editor, I set the shell to /bin/bash and then started the /bin/bash shell from within vi. Here are the commands I used in vi: :

```bash
:set shell=bin/bash
:shell
```
So that , i have a shell in vi. In home directory there is two directories (two users) , jerry and tom. In jerry directory there is fourth flag. For full access to system commands i run the next to export commands.

```bash
export PATH=/bin:/usr/bin:/sbin:$PATH
export SHELL=/bin/sh
```
I set the PATH and SHELL environment variables to gain access to system commands and ensure that the shell is set to /bin/bash. Now, I have a fully functional bash shell, but I still don't have root privileges.

## 4 - Privilege escalation

I run the command sudo -l to see what i can do with sudo privileges.And machine asks me to password so i give. And it returned “ Sorry, user tom may not run sudo on DC-2.” . So i switch user to jerry.

![DC2](https://miro.medium.com/v2/resize:fit:640/format:webp/1*TjQfcIuDaP08-1uFryvb8A.png "DC2")

Jerry can only use the command git. I searched how to escalate our privileges with this “git” command. I searched in GFTOBins.

![DC2](https://miro.medium.com/v2/resize:fit:828/format:webp/1*lmdHkzodEZh_RWtGk39cUQ.png "DC2")

I used the second option. When the config page appeared on my screen, the -p flag prompted me for my password.

```bash
sudo git -p help config
!/bin/sh
```
I then typed !/bin/bash to spawn a shell with root privileges. Now, I am root, and the final flag is located in the /root directory.